<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SIMONS - Inicio</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/sidebars.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/dataTables.dataTables.min.css}">

    <style>
        body {
            background-color: #f8f9fa;
        }

        .flex-container {
            display: flex;
            align-items: center;
        }

        .flex-space-around {
            justify-content: space-around;
        }

        .margin-right-20 {
            margin-right: 20px;
        }

        .margin-right-10 {
            margin-right: 10px;
        }

        .margin-right-5 {
            margin-right: 5px;
        }

        .text-center {
            text-align: center;
        }


        .title-cronograma {
            background-color: #0070c0;
            color: white;
        }


        #tablero-izquierdo {
            width: 50%;
        }

        #tablero-derecho {
            width: 50%;
        }


        .container-indicador {
            width: 100px;
            font-size: 14px;
            box-shadow: 4px 4px 8px 0px rgba(0, 0, 0, 0.75);
            margin: 10px 0;
        }

        .indicador-valor {
            font-size: 30px;
            font-weight: bold;
            color: white;
            line-height: 50px;
        }

        .footer-indicador {
            font-size: 12px;
            line-height: 20px;
            font-weight: bold;
        }

        .nombre-indicador {
            color: white;
            font-size: 12px;
            line-height: 20px;
            font-weight: bold;
        }

        .col-title-numero-fase {
            width: 25%;
        }

        .col-title-fase {
            width: 75%;
            background-color: #fce4d6 !important;
            font-weight: bold;
        }

        .col-actividad {
            width: 25%;
        }

        .col-responsable {
            width: 25%;
        }

        .col-fecha-inicio {
            width: 10%;
        }

        .col-num-dias {
            width: 7%;
        }

        .col-fecha-fin {
            width: 10%;
        }

        .col-avance {
            width: 5%;
        }

        .col-estado {
            width: 10%;
        }

        .col-button-editar {
            width: 8%;
        }
    </style>
</head>
<body>
<svg th:replace="~{fragments/sidebar :: svgIcons}"></svg>
<main>
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    <div class="divider"></div>
    <div class="container overflow-auto">
        <div class="contenido">
            <div class="title-cronograma flex-container flex-space-around">
                <h1 class="margin-right-20">Cronograma</h1>
                <!--            <div class="flex-container">-->
                <!--                <label class="margin-right-10">Excluir</label>-->
                <!--                <label for="sabado" class="margin-right-5">Sábado</label><input type="checkbox" id="sabado"/>-->
                <!--                <label for="domingo" class="margin-right-5">Domingo</label><input type="checkbox" id="domingo"/>-->
                <!--            </div>-->
            </div>
            <div class="tablero flex-container">
                <div id="tablero-izquierdo">
                    <div class="flex-container flex-space-around">
                        <div>
                            Proyecto: <span th:text="${proyecto.nombre}"></span>
                        </div>
                        <div>
                            Fecha Actual: 04/08/2024
                        </div>
                    </div>
                    <div class="flex-container flex-space-around">
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #9dc3e6">
                                <span th:text="${indicadoresProyecto.totalActividades}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #0070c0;">
                                Actividades
                            </div>
                            <div class="footer-indicador">
                                Total
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #d0cece;">
                                <span th:text="${indicadoresProyecto.totalActividadesSinEmpezar}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #767171;">
                                Sin Empezar
                            </div>
                            <div class="footer-indicador">
                                Estado
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #ffd966;">
                                <span th:text="${indicadoresProyecto.totalActividadesEnProceso}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #ffc000;">
                                En proceso
                            </div>
                            <div class="footer-indicador">
                                Estado
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #f4b183;">
                                <span th:text="${indicadoresProyecto.totalActividadesAtrasados}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #ff3300;">
                                Atrasado
                            </div>
                            <div class="footer-indicador">
                                Estado
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #a9d18e;">
                                <span th:text="${indicadoresProyecto.totalActividadesCompletadas}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #548235;">
                                Completado
                            </div>
                            <div class="footer-indicador">
                                Estado
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #9dc3e6;">
                                <span th:text="${indicadoresProyecto.totalPorcentajeAvance}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #0070c0;">
                                Proyecto
                            </div>
                            <div class="footer-indicador">
                                % Avance
                            </div>
                        </div>
                    </div>
                </div>
                <div id="tablero-derecho">
                    <div class="flex-container flex-space-around">
                        <div>
                            Fecha Inicio: <span th:text="${proyecto.fechaInicio}"></span>
                        </div>
                        <div>
                            Fecha Fin: <span th:text="${proyecto.fechaFin}"></span>
                        </div>
                    </div>
                    <div class="flex-container flex-space-around">
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #9dc3e6;">
                                <span th:text="${duracionMeses}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #0070c0;">
                                Duración
                            </div>
                            <div class="footer-indicador">
                                Meses
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #9dc3e6;">
                                <span th:text="${duracionDias}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #0070c0;">
                                Duración
                            </div>
                            <div class="footer-indicador">
                                Días
                            </div>
                        </div>
                        <div class="container-indicador text-center">
                            <div class="indicador-valor" style="background-color: #f8cbad;">
                                <span th:text="${cantidadFechasExcluidas}"></span>
                            </div>
                            <div class="nombre-indicador" style="background-color: #f4b183;">
                                Días
                            </div>
                            <div class="footer-indicador">
                                Excluidos
                            </div>
                        </div>
                        <!--                    <div class="container-indicador text-center">-->
                        <!--                        <div class="indicador-valor" style="background-color: #9dc3e6;">0</div>-->
                        <!--                        <div class="nombre-indicador" style="background-color: #0070c0;">-->
                        <!--                            Duración-->
                        <!--                        </div>-->
                        <!--                        <div class="footer-indicador">-->
                        <!--                            Meses-->
                        <!--                        </div>-->
                        <!--                    </div>-->
                        <!--                    <div class="container-indicador text-center">-->
                        <!--                        <div class="indicador-valor" style="background-color: #9dc3e6;">0</div>-->
                        <!--                        <div class="nombre-indicador" style="background-color: #0070c0;">-->
                        <!--                            Duración-->
                        <!--                        </div>-->
                        <!--                        <div class="footer-indicador">-->
                        <!--                            Días-->
                        <!--                        </div>-->
                        <!--                    </div>-->
                    </div>
                </div>
            </div>
            <div class="cronograma">
                <div class="flex-container">
                    <button class="btn btn-primary" id="btn-add-actividad">Agregar Actividad</button>
                </div>
                <table id="header" class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th class="col-actividad">Actividad</th>
                        <th class="col-responsable">Responsable</th>
                        <th class="col-fecha-inicio">Fecha Inicio</th>
                        <th class="col-num-dias">N° Días</th>
                        <th class="col-fecha-fin">Fecha Fin</th>
                        <th class="col-avance">Avance</th>
                        <th class="col-estado">Estado</th>
                        <th class="col-button-editar">Botón</th>
                    </tr>
                    </thead>
                </table>
                <table id="fase1" class="table table-striped table-bordered">
                    <tbody>
                    <!-- Fase 1 -->
                    <tr>
                        <th class="col-title-numero-fase" style="font-weight: bold">FASE 1</th>
                        <!-- Utiliza 6 espacios de la tabla -->
                        <th class="col-title-fase" colspan="7">ESPECIALIDAD ACABADOS</th>
                    </tr>
                    <tr th:each="detalle : ${detallesFase1}" th:data-id="${detalle.id}">
                        <td class="col-actividad" th:text="${detalle.actividad}">Reunión de inicio</td>
                        <td class="col-responsable" th:text="${detalle.responsable.nombre}">Gerente de
                            proyecto
                        </td>
                        <td class="col-fecha-inicio" th:text="${detalle.fechaInicio}">01/01/2022</td>
                        <td class="col-num-dias" th:text="${detalle.numeroDias}">1</td>
                        <td class="col-fecha-fin" th:text="${detalle.fechaFin}">02/01/2022</td>
                        <td class="col-avance" th:text="${detalle.porcentajeAvance} + '%'">100%</td>
                        <td class="col-estado" th:text="${detalle.estado}">Completado</td>
                        <td class="col-button-editar">
                            <button class="btn btn-danger" th:data-col-fase1-id="${detalle.id}" disabled>Editar
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <table id="fase2" class="table table-striped table-bordered">
                    <tbody>
                    <!-- Fase 1 -->
                    <tr>
                        <th class="col-title-numero-fase">FASE 2</th>
                        <!-- Utiliza 6 espacios de la tabla -->
                        <th class="col-title-fase" colspan="6">ESPECIALIDAD SANITARIOS</th>
                    </tr>
                    <tr th:each="detalle : ${detallesFase2}" th:data-id="${detalle.id}">
                        <td class="col-actividad" th:text="${detalle.actividad}">Reunión de inicio</td>
                        <td class="col-responsable" th:text="${detalle.responsable.nombre}">Gerente de
                            proyecto
                        </td>
                        <td class="col-fecha-inicio" th:text="${detalle.fechaInicio}">01/01/2022</td>
                        <td class="col-num-dias" th:text="${detalle.numeroDias}">1</td>
                        <td class="col-fecha-fin" th:text="${detalle.fechaFin}">02/01/2022</td>
                        <td class="col-avance" th:text="${detalle.porcentajeAvance} + '%'">100%</td>
                        <td class="col-estado" th:text="${detalle.estado}">Completado</td>
                        <td class="col-button-editar">
                            <button class="btn btn-danger" th:data-col-fase1-id="${detalle.id}" disabled>Editar
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <table id="fase3" class="table table-striped table-bordered">
                    <tbody>
                    <!-- Fase 1 -->
                    <tr>
                        <th class="col-title-numero-fase">FASE 3</th>
                        <!-- Utiliza 6 espacios de la tabla -->
                        <th class="col-title-fase" colspan="6">ESPECIALIDAD DE ELECTRICIDAD</th>
                    </tr>
                    <tr th:each="detalle : ${detallesFase3}" th:data-id="${detalle.id}">
                        <td class="col-actividad" th:text="${detalle.actividad}">Reunión de inicio</td>
                        <td class="col-responsable" th:text="${detalle.responsable.nombre}">Gerente de
                            proyecto
                        </td>
                        <td class="col-fecha-inicio" th:text="${detalle.fechaInicio}">01/01/2022</td>
                        <td class="col-num-dias" th:text="${detalle.numeroDias}">1</td>
                        <td class="col-fecha-fin" th:text="${detalle.fechaFin}">02/01/2022</td>
                        <td class="col-avance" th:text="${detalle.porcentajeAvance} + '%'">100%</td>
                        <td class="col-estado" th:text="${detalle.estado}">Completado</td>
                        <td class="col-button-editar">
                            <button class="btn btn-danger" th:data-col-fase1-id="${detalle.id}" disabled>Editar
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <table id="fase4" class="table table-striped table-bordered">
                    <tbody>
                    <!-- Fase 1 -->
                    <tr>
                        <th class="col-title-numero-fase">FASE 4</th>
                        <!-- Utiliza 6 espacios de la tabla -->
                        <th class="col-title-fase" colspan="6">ESPECIALIDAD DE REDES Y COMUNICACIONES</th>
                    </tr>
                    <tr th:each="detalle : ${detallesFase4}" th:data-id="${detalle.id}">
                        <td class="col-actividad" th:text="${detalle.actividad}">Reunión de inicio</td>
                        <td class="col-responsable" th:text="${detalle.responsable.nombre}">Gerente de
                            proyecto
                        </td>
                        <td class="col-fecha-inicio" th:text="${detalle.fechaInicio}">01/01/2022</td>
                        <td class="col-num-dias" th:text="${detalle.numeroDias}">1</td>
                        <td class="col-fecha-fin" th:text="${detalle.fechaFin}">02/01/2022</td>
                        <td class="col-avance" th:text="${detalle.porcentajeAvance} + '%'">100%</td>
                        <td class="col-estado" th:text="${detalle.estado}">Completado</td>
                        <td class="col-button-editar">
                            <button class="btn btn-danger" th:data-col-fase1-id="${detalle.id}" disabled>Editar
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal for adding a new activity -->
        <div class="modal fade" id="modal-add-actividad" tabindex="-1" aria-labelledby="modalAddActividadLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalAddActividadLabel">Agregar Actividad</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-add-actividad">
                            <div class="mb-3">
                                <label for="fase" class="form-label">Fase</label>
                                <select class="form-select" id="fase" required>
                                    <option value="" disabled selected>Seleccione una fase</option>
                                    <option th:value="${idFase1}">Fase 1</option>
                                    <option th:value="${idFase2}">Fase 2</option>
                                    <option th:value="${idFase3}">Fase 3</option>
                                    <option th:value="${idFase4}">Fase 4</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="actividad" class="form-label">Actividad</label>
                                <input type="text" class="form-control" id="actividad" required>
                            </div>
                            <div class="mb-3">
                                <label for="responsable" class="form-label">Responsable</label>
                                <select class="form-select" id="responsable" required>
                                    <option value="" disabled selected>Seleccione un responsable</option>
                                    <option th:each="responsable : ${responsables}" th:value="${responsable.id}"
                                            th:text="${responsable.nombre}"></option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="fecha-inicio" class="form-label">Fecha Inicio</label>
                                <input type="date" class="form-control" id="fecha-inicio" required>
                            </div>
                            <div class="mb-3">
                                <label for="num-dias" class="form-label">N° Días</label>
                                <input type="number" class="form-control" id="num-dias" required>
                            </div>
                            <div class="mb-3">
                                <label for="fecha-fin" class="form-label">Fecha Fin</label>
                                <input type="date" class="form-control" id="fecha-fin" required>
                            </div>
                            <div class="mb-3">
                                <label for="avance" class="form-label">% Avance</label>
                                <input type="number" class="form-control" id="avance" max="100" min="0" required>
                            </div>
                            <div class="mb-3">
                                <label for="estado" class="form-label">Estado</label>
                                <select class="form-select" id="estado" required>
                                    <option value="" disabled selected>Seleccione un estado</option>
                                    <option value="Sin Empezar">Sin Empezar</option>
                                    <option value="En Proceso">En Proceso</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Atrasado">Atrasado</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary" form="form-add-actividad">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer" style="position: fixed;bottom: 0;width: 100%;background-color: #f8f9fa;padding: 10px;text-align: center;">
            <div class="footer-content" style="display: flex;width: 100%;">
                <div class="left" style="text-align: left;">
                    <span style="font-weight: bold">MERAKI GROUP</span>@2024|Todos los derechos reservados
                </div>
                <div class="right" style="text-align: right; padding-left: 40%">
                    Creado por <span style="font-weight: bold">SIMONS</span>
                </div>
            </div>
        </div>

    </div>
</main>
<script>

    document.getElementById('btn-add-actividad').addEventListener('click', function () {
        $('#modal-add-actividad').modal('show');

    });

    document.getElementById('form-add-actividad').addEventListener('submit', function (event) {
        event.preventDefault();
        const fase = document.getElementById('fase').value;
        const actividad = document.getElementById('actividad').value;
        const responsable = document.getElementById('responsable').value;
        const fechaInicio = document.getElementById('fecha-inicio').value;
        const numDias = document.getElementById('num-dias').value;
        const fechaFin = document.getElementById('fecha-fin').value;
        const avance = document.getElementById('avance').value;
        const estado = document.getElementById('estado').value;

        console.log(fase, actividad, responsable, fechaInicio, numDias, fechaFin, avance, estado);

        // Aquí se enviaría la información al servidor
        let url = '/api/proyectos/fase/' + fase + '/detalle-fase/guardar'
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                actividad: actividad,
                responsableId: responsable,
                fechaInicio: fechaInicio,
                numeroDias: numDias,
                fechaFin: fechaFin,
                porcentajeAvance: avance + '%',
                estado: estado
            })
        }).then(response => {
            if (response.ok) {
                return response.text();
            }
            throw new Error('Error en la llamada a la API');
        }).then(data => {
            console.log(data);
            $('#modal-add-actividad').modal('hide');
            // recargar la pagina
            location.reload();
        }).catch(error => {
            console.error(error);
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link');

        navLinks.forEach(function (link) {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            } else {
                link.classList.add('link-dark');
            }
        });

        const estadoCells = document.querySelectorAll('.col-estado');
        estadoCells.forEach(cell => {
            const estado = cell.textContent.trim();
            if (estado === 'Completado') {
                cell.classList.add('bg-success');
            } else if (estado === 'Atrasado') {
                cell.classList.add('bg-danger');
            } else if (estado === 'En Proceso') {
                cell.classList.add('bg-warning');
            } else if (estado === 'Sin Empezar') {
                cell.classList.add('bg-secondary');
            }
        });

    });
</script>
<script th:src="@{/js/jquery-3.7.1.min.js}"></script>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/moment.min.js}"></script>
<script th:src="@{/js/dataTables.min.js}"></script>
</body>
</html>